########################################
## COMPONENT | mysql
########################################
mysql:
  image:
    repository: mysql
    tag: 8.0.32
    pullPolicy: IfNotPresent
    pullSecret: ""
    uid: 999
    gid: 999

  ## the securityContext configs for mysql Pods
  ## - spec for PodSecurityContext:
  ##   https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#podsecuritycontext-v1-core
  ##
  podSecurityContext:
    ## sets filesystem owner group of in mounted volumes, ensuring pod has permissions to read DB data
    fsGroup: 999

  ## resource requests/limits for mysql Pods
  ## - spec for ResourceRequirements:
  ##   https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#resourcerequirements-v1-core
  ##
  resources: {}

  ## persistence configs for mysql
  ##
  persistence:
    enabled: true

    ## the name of an existing PersistentVolumeClaim to use
    ## - if non-emtpy, you must manually create a PVC with this name
    ##
    existingClaim: ""

    ## the sub-path within the PersistentVolume to mount, instead of the root
    ##
    subPath: ""

    ## the name of the StorageClass requested by the PersistentVolumeClaim
    ## - if set to "", then `PersistentVolumeClaim/spec.storageClassName` is omitted
    ## - if set to "-", then `PersistentVolumeClaim/spec.storageClassName` is set to ""
    ##
    storageClass: ""

    ## the access mode of the PersistentVolumeClaim
    ##
    accessMode: ReadWriteOnce

    ## the initial size for the PersistentVolumeClaim to request
    ## - kubernetes allows the PVC to grow in size as needed, starting from this value
    ##   (if your StorageClass has `allowVolumeExpansion=true`)
    ##
    size: 5Gi

  ## configs for the "root@localhost" mysql user
  ##
  rootUser:
    password: {{< .Values.deploykf_opt.kubeflow_mysql.rootUser.password | quote >}}
    existingSecret: {{< .Values.deploykf_opt.kubeflow_mysql.rootUser.existingSecret | quote >}}
    existingSecretPasswordKey: {{< .Values.deploykf_opt.kubeflow_mysql.rootUser.existingSecretPasswordKey | quote >}}

  ## configs for the "kubeflow" mysql user
  ##
  kubeflowUser:
    username: {{< .Values.deploykf_opt.kubeflow_mysql.kubeflowUser.username | quote >}}
    password: {{< .Values.deploykf_opt.kubeflow_mysql.kubeflowUser.password | quote >}}
    existingSecret: {{< .Values.deploykf_opt.kubeflow_mysql.kubeflowUser.existingSecret | quote >}}
    existingSecretUsernameKey: {{< .Values.deploykf_opt.kubeflow_mysql.kubeflowUser.existingSecretUsernameKey | quote >}}
    existingSecretPasswordKey: {{< .Values.deploykf_opt.kubeflow_mysql.kubeflowUser.existingSecretPasswordKey | quote >}}

  ## the string content of a config file mounted at `/etc/mysql/conf.d/custom.cnf`
  ##
  configuration: |
    [mysqld]
    default_authentication_plugin=mysql_native_password

  ## mysql databases to create with the init_file
  ##
  databases:
    {{<- if .Values.kubeflow_tools.katib.enabled >}}
    - name: {{< .Values.kubeflow_tools.katib.mysqlDatabase | quote >}}
    {{<- end >}}
    {{<- if .Values.kubeflow_tools.pipelines.enabled >}}
    - name: {{< .Values.kubeflow_tools.pipelines.mysqlDatabases.cacheDatabase | quote >}}
    - name: {{< .Values.kubeflow_tools.pipelines.mysqlDatabases.metadataDatabase | quote >}}
    - name: {{< .Values.kubeflow_tools.pipelines.mysqlDatabases.pipelinesDatabase | quote >}}
    {{<- end >}}
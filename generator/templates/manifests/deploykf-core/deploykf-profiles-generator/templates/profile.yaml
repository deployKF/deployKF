{{- range $profile_name, $profile := .Values.profiles }}
{{- $profile_name := printf "%s%s" $.Values.profileDefaults.profileNamePrefix $profile_name }}
---
apiVersion: kubeflow.org/v1
kind: Profile
metadata:
  name: {{ $profile_name | quote }}
  labels:
    helm.sh/chart: {{ include "deploykf-profiles-generator.labels.chart" $ }}
    app.kubernetes.io/name: {{ include "deploykf-profiles-generator.labels.name" $ }}
    app.kubernetes.io/instance: {{ $.Release.Name }}
    app.kubernetes.io/managed-by: {{ $.Release.Service }}
spec:
  owner:
    kind: User
    name: {{ $.Values.profileDefaults.ownerEmail | quote }}
  {{- if $profile.resourceQuotaSpec }}
  resourceQuotaSpec: {{ $profile.resourceQuotaSpec | toYaml | nindent 4 }}
  {{- else }}
  resourceQuotaSpec: {}
  {{- end }}
  {{- if $profile.plugins }}
  plugins: {{ $profile.plugins | toYaml | nindent 4 }}
  {{- end }}
{{- end }}
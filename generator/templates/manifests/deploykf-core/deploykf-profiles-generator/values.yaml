deployKF:
  extraManifests:
    {{<- range $manifest := .Values.deploykf_core.deploykf_profiles_generator.extraManifests >}}
    - {{< (tpl $manifest $) | quote >}}
    {{<- end >}}

  clusterDomain: cluster.local

  kubeflow:
    useridHeader: kubeflow-userid

    pipelines:
      enabled: {{< .Values.kubeflow_tools.pipelines.enabled | conv.ToBool >}}
      pipelineUI:
        namespace: kubeflow
        serviceAccount: ml-pipeline-ui

  gateway:
    namespace: {{< .Values.deploykf_core.deploykf_istio_gateway.namespace | quote >}}
    serviceAccount: {{< .Values.deploykf_core.deploykf_istio_gateway.gatewayDeployment.serviceAccount.name | quote >}}
    emailToLowercase: {{< .Values.deploykf_core.deploykf_istio_gateway.gateway.emailToLowercase | conv.ToBool >}}


## configs for generated profiles
##
profileDefaults:

  ## a common prefix to add to all profile names
  ##
  profileNamePrefix: {{< .Values.deploykf_core.deploykf_profiles_generator.profileDefaults.profileNamePrefix | quote >}}

  ## the default email to set as the OWNER of profiles
  ##
  ownerEmail: {{< .Values.deploykf_core.deploykf_profiles_generator.profileDefaults.ownerEmail | quote >}}

  ## the default access for members of profiles
  ##
  memberAccess:

    ## the default RBAC role to bind to members
    ##  - "edit" -> `ClusterRole/kubeflow-edit` -> can view/create/delete resources
    ##  - "view" -> `ClusterRole/kubeflow-view` -> can only view resources
    ##
    role: {{< .Values.deploykf_core.deploykf_profiles_generator.profileDefaults.memberAccess.role | quote >}}

    ## if the user can ~connect~ to notebooks in the profile
    notebooksAccess: {{< .Values.deploykf_core.deploykf_profiles_generator.profileDefaults.memberAccess.notebooksAccess | conv.ToBool >}}

  ## the default plugins for profiles
  ##  - available plugin "kinds":
  ##     - "AwsIamForServiceAccount":
  ##        https://github.com/kubeflow/kubeflow/blob/v1.7.0/components/profile-controller/controllers/plugin_iam.go#L30
  ##     - "WorkloadIdentity":
  ##        https://github.com/kubeflow/kubeflow/blob/v1.7.0/components/profile-controller/controllers/plugin_workload_identity.go#L39
  ##
  plugins: {{< .Values.deploykf_core.deploykf_profiles_generator.profileDefaults.plugins | toJSON >}}

  ## the resource quota for this profile
  ##  - spec for ResourceQuotaSpec:
  ##    https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.25/#resourcequotaspec-v1-core
  ##
  resourceQuotaSpec: {{< .Values.deploykf_core.deploykf_profiles_generator.profileDefaults.resourceQuotaSpec | toJSON >}}


## user entities
##
users:
  {{<- range $user := .Values.deploykf_core.deploykf_profiles_generator.users >}}
  {{< $user.id | quote >}}: {{< $user | coll.Omit "id" | toJSON >}}
  {{<- end >}}

## profile definitions
##
profiles:
  {{<- range $profile := .Values.deploykf_core.deploykf_profiles_generator.profiles >}}
  {{< $profile.name | quote >}}: {{< $profile | coll.Omit "name" | toJSON >}}
  {{<- end >}}

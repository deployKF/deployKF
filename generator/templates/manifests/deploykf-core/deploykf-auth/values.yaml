deployKF_helpers:
  deploykf_gateway:
    http_endpoint: {{< (tmpl.Exec "deploykf_gateway.http_endpoint" .) | quote >}}
    https_endpoint: {{< (tmpl.Exec "deploykf_gateway.https_endpoint" .) | quote >}}
    is_self_signed_cert: {{< (tmpl.Exec "deploykf_gateway.is_self_signed_cert" .) | quote >}}

deployKF:
  clusterDomain: cluster.local

  kubeflow:
    namespace: kubeflow
    useridHeader: kubeflow-userid

  certManager:
    clusterIssuer:
      selfSigned:
        injectedConfigMapName: {{< .Values.deploykf_dependencies.cert_manager.clusterIssuer.selfSigned.injectedConfigMapName | quote >}}

  istio:
    namespace: {{< .Values.deploykf_dependencies.istio.namespace | quote >}}

  gateway:
    namespace: {{< .Values.deploykf_core.deploykf_istio_gateway.namespace | quote >}}
    serviceAccount: {{< .Values.deploykf_core.deploykf_istio_gateway.serviceAccount.name | quote >}}
    name: {{< .Values.deploykf_core.deploykf_istio_gateway.gateway.name | quote >}}
    hostname: {{< .Values.deploykf_core.deploykf_istio_gateway.gateway.hostname | quote >}}
    tls:
      enabled: {{< .Values.deploykf_core.deploykf_istio_gateway.gateway.tls.enabled >}}


########################################
## COMPONENT | dex
########################################
dex:
  ## configs for the dex container image
  ##
  image:
    repository: ghcr.io/dexidp/dex
    tag: v2.35.3
    pullPolicy: IfNotPresent
    pullSecret: ""
    uid: 1001
    gid: 1001

  ## resource requests/limits for the dex Pods
  ## - spec for ResourceRequirements:
  ##   https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#resourcerequirements-v1-core
  ##
  resources: {}

  ## OpenID client configs for dex
  ##
  clients:

    ## OpenID client for oauth2-proxy
    ## - [WARNING] these configs must align with `oauth2Proxy.oidc.*`
    ##
    oauth2Proxy:
      clientId: "oauth2-proxy"
      clientSecret:
        value: "bbbbbbbbbbbbbbbb"
        ## TODO: test with existing secret
        existingSecret: ""
        existingSecretKey: "client_secret"

    ## OpenID client for minio-console
    ##
    minio:
      enabled: {{< .Values.deploykf_opt.deploykf_minio.enabled >}}
      clientId: "minio-console"
      clientSecret:
        value: "bbbbbbbbbbbbbbbb"
        ## TODO: test with existing secret
        existingSecret: ""
        existingSecretKey: "client_secret"

    ## OpenID client for argo-server
    ##
    argoServer:
      enabled: {{< .Values.kubeflow_dependencies.kubeflow_argo_workflows.enabled >}}
      clientId: "argo-server"
      clientSecret:
        value: "bbbbbbbbbbbbbbbb"
        ## TODO: test with existing secret
        existingSecret: ""
        existingSecretKey: "client_secret"

  ## TODO: replace `staticPasswords` with a list, allowing `existingSecret` as one of the keys
  staticPasswords:
    value:
      ## default admin (username: "admin@example.com", password: "admin")
      - email: "admin@example.com"
        ## bcrypt hash of "admin":
        ##  echo "admin" | htpasswd -BinC 10 NULL | cut -d: -f2
        hash: "$2y$10$uIPSv59XLpcS6iFGltZkOep/QuJv8z7Nry6n.LsRXb2Qt0Wsenzbu"
        username: "admin@example.com"
        userID: "00000000-0000-0000-0000-000000000000"

      ## default user1 (username: "user1@example.com", password: "user1")
      - email: "user1@example.com"
        ## bcrypt hash of "user1":
        ##  echo "user1" | htpasswd -BinC 10 NULL | cut -d: -f2
        hash: "$2y$10$/eC.AP5m0ObnYKjmDbSEeeG8dXAb3BGZhwPJf6FRxWFV11dzaDu16"
        username: "user1@example.com"
        userID: "00000000-0000-0000-0000-000000000001"

      ## default user2 (username: "user2@example.com", password: "user2")
      - email: "user2@example.com"
        ## bcrypt hash of "user2":
        ##  echo "user2" | htpasswd -BinC 10 NULL | cut -d: -f2
        hash: "$2y$10$1C.vyfnl3o09VDbeZvT6ueSLLaIvQsJ5IO1H2iAzR1JVcjdNroikO"
        username: "user2@example.com"
        userID: "00000000-0000-0000-0000-000000000002"

    existingSecret: ""
    existingSecretKey: "static_passwords"

  ## TODO: replace `connectors` with a list, allowing `existingSecret` as one of the keys
  connectors:
    value: []

    existingSecret: ""
    existingSecretKey: "connectors"


########################################
## COMPONENT | oauth2-proxy
########################################
oauth2Proxy:
  ## configs for the oauth2-proxy container image
  ##
  image:
    repository: quay.io/oauth2-proxy/oauth2-proxy
    tag: v7.4.0
    pullPolicy: IfNotPresent
    pullSecret: ""
    uid: 65532
    gid: 65532

  ## resource requests/limits for the oauth2-proxy Pods
  ## - spec for ResourceRequirements:
  ##   https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.20/#resourcerequirements-v1-core
  ##
  resources: {}

  ## OpenID configs for oauth2-proxy
  ##
  oidc:
    clientId: "oauth2-proxy"
    clientSecret:
      value: "bbbbbbbbbbbbbbbb"

      ## TODO: test with existing secret
      existingSecret: ""
      existingSecretKey: "client_secret"

  ## cookie configs for oauth2-proxy
  ##
  cookie:
    ## sets oauth2-proxy config: `cookie_name`
    ##
    name: _kubeflow_token

    ## sets oauth2-proxy config: `cookie_expire`
    ##
    expire: 12h

    ## sets oauth2-proxy config: `cookie_refresh`
    ##
    refresh: 1h

    ## sets oauth2-proxy config: `cookie_secret`
    ##
    secret:
      value: cccccccccccccccc
      existingSecret: ""
      existingSecretKey: "cookie_secret"